<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Razorpay Payment</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    #upiId {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
    }

    button {
      width: 100%;
      padding: 10px;
      background-color: #1B5928;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
  </style>
</head>
<body>
  <div class="container">
    <label for="upiId">Enter your UPI ID:</label>
    <input type="text" id="upiId" placeholder="Enter UPI ID">
    <button onclick="initiateRazorpay(enableSaveAndContinue)">Initiate Payment</button>

    <!-- Payment status will be displayed here -->
    <div id="payment-status"></div>
  </div>

  <input
    type="hidden"
    name="payment_source_id"
    value="<%= payment_method.id %>"
    data-solidus-stripe-payment-target="paymentMethodInput"
  >

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    var razorpayKey = 'rzp_test_452ST3VCdXCSSJ';
    var paymentSuccessful = false;

    function initiateRazorpay(callback) {
      var upiId = document.getElementById('upiId').value;

      if (!upiId) {
        alert('Please enter a valid UPI ID');
        return;
      }

      var options = {
        key: razorpayKey,
        amount: 1000,
        currency: 'INR',
        name: 'Your Company Name',
        description: 'Payment for Order #123',
        image: 'https://example.com/logo.png',
        handler: function (response) {
          handleSuccessfulPayment(response.razorpay_payment_id);
          if (callback) {
            callback(); // Call the callback function after successful payment
          }
        },
        prefill: {
          email: 'customer@example.com',
          contact: '9876543210',
          upi_id: document.getElementById('upiId').value,
        },
      };

      var rzp = new Razorpay(options);
      rzp.open();
    }

    function handleSuccessfulPayment(paymentId) {
      var upiId = document.getElementById('upiId').value;

      var paymentStatus = 'Payment successful. UPI ID: ' + upiId + ', Payment ID: ' + paymentId;

      document.getElementById('payment-status').innerHTML = paymentStatus;

      paymentSuccessful = true;

      document.querySelector('button').disabled = true;
    }

    function enableSaveAndContinue() {
      if (paymentSuccessful) {
        document.getElementById('saveAndContinueButton').disabled = false;
      } else {
        alert('Please complete the payment first.');
      }
    }

    // Disable the "Save and Continue" button initially
    document.getElementById('saveAndContinueButton').disabled = true;
  </script>
</body>
</html>
